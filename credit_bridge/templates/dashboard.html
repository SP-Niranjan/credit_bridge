{% extends "base.html" %} {% block title %}Analytics Dashboard - CreditBridge{% endblock %} {% block extra_css %}
<style>
  .stat-card {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    text-align: center;
    height: 100%;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .stat-icon {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    font-size: 2rem;
    color: white;
  }

  .stat-value {
    font-size: 2.5rem;
    font-weight: 700;
    color: #1f2937;
  }

  .stat-label {
    color: #6b7280;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.875rem;
  }

  .chart-card {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }

  .table-card {
    background: white;
    border-radius: 15px;
    padding: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  }
</style>
{% endblock %} {% block content %}
<div class="row">
  <div class="col-12">
    <div class="text-center mb-4">
      <h1 class="display-5 fw-bold" style="color: white">
        <i class="bi bi-graph-up"></i> Analytics Dashboard
      </h1>
      <p style="color: rgba(255, 255, 255, 0.9)">
        Comprehensive overview of credit assessment performance
      </p>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stat-card">
          <div
            class="stat-icon"
            style="background: linear-gradient(135deg, #4f46e5, #7c3aed)"
          >
            <i class="bi bi-file-earmark-text"></i>
          </div>
          <div class="stat-value">{{ stats.total }}</div>
          <div class="stat-label">Total Assessments</div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stat-card">
          <div
            class="stat-icon"
            style="background: linear-gradient(135deg, #3b82f6, #2563eb)"
          >
            <i class="bi bi-star"></i>
          </div>
          <div class="stat-value">{{ stats.avg_score }}</div>
          <div class="stat-label">Average Score</div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stat-card">
          <div
            class="stat-icon"
            style="background: linear-gradient(135deg, #10b981, #059669)"
          >
            <i class="bi bi-check-circle"></i>
          </div>
          <div class="stat-value">{{ stats.low_risk_percent }}%</div>
          <div class="stat-label">Low Risk %</div>
        </div>
      </div>

      <div class="col-lg-3 col-md-6 mb-3">
        <div class="card stat-card">
          <div
            class="stat-icon"
            style="background: linear-gradient(135deg, #f59e0b, #d97706)"
          >
            <i class="bi bi-graph-up-arrow"></i>
          </div>
          <div class="stat-value">{{ stats.approval_rate }}%</div>
          <div class="stat-label">Approval Rate</div>
        </div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="row">
      <div class="col-lg-6 mb-3">
        <div class="chart-card">
          <h4 class="mb-4">
            <i class="bi bi-pie-chart"></i> Risk Distribution
          </h4>
          <canvas id="pieChart"></canvas>
          <div class="row mt-4 text-center">
            <div class="col-4">
              <div class="badge bg-success mb-2">Low Risk</div>
              <div><strong>{{ stats.low_risk }}</strong> applications</div>
            </div>
            <div class="col-4">
              <div class="badge bg-warning text-dark mb-2">Medium Risk</div>
              <div><strong>{{ stats.medium_risk }}</strong> applications</div>
            </div>
            <div class="col-4">
              <div class="badge bg-danger mb-2">High Risk</div>
              <div><strong>{{ stats.high_risk }}</strong> applications</div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mb-3">
        <div class="chart-card">
          <h4 class="mb-4">
            <i class="bi bi-graph-up"></i> Recent Score Trend
          </h4>
          <canvas id="lineChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Recent Applications Table -->
    <div class="table-card">
      <h4 class="mb-4">
        <i class="bi bi-clock-history"></i> Recent Applications
      </h4>
      {% if recent|length > 0 %}
      <div class="table-responsive">
        <table class="table table-hover">
          <thead style="background: #f3f4f6">
            <tr>
              <th>Applicant Name</th>
              <th>Credit Score</th>
              <th>Risk Category</th>
              <th>Date</th>
            </tr>
          </thead>
          <tbody>
            {% for app in recent %}
            <tr>
              <td><i class="bi bi-person"></i> {{ app.name }}</td>
              <td>
                <span
                  class="badge {% if app.score >= 750 %}bg-success{% elif app.score >= 600 %}bg-warning text-dark{% else %}bg-danger{% endif %} px-3 py-2"
                >
                  {{ app.score }}
                </span>
              </td>
              <td>
                <span
                  class="badge {% if app.risk == 'Low Risk' %}bg-success{% elif app.risk == 'Medium Risk' %}bg-warning text-dark{% else %}bg-danger{% endif %}"
                >
                  {{ app.risk }}
                </span>
              </td>
              <td>{{ app.date }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center py-5 text-muted">
        <i class="bi bi-inbox" style="font-size: 3rem"></i>
        <p class="mt-3">No recent applications</p>
      </div>
      {% endif %}
    </div>

    <div class="text-center mt-4">
      <a href="{{ url_for('home') }}" class="text-white">
        <i class="bi bi-arrow-left"></i> Back to Home
      </a>
      <span class="text-white mx-2">|</span>
      <a href="{{ url_for('applications') }}" class="text-white">
        <i class="bi bi-list-ul"></i> View All Applications
      </a>
    </div>
  </div>
</div>

{% endblock %} {% block extra_js %}
<script>
  /* eslint-disable */
  // Disable linting for Jinja2 template syntax

  // Pie Chart - Risk Distribution
  const pieCtx = document.getElementById('pieChart').getContext('2d');
  new Chart(pieCtx, {
      type: 'pie',
      data: {
          labels: ['Low Risk', 'Medium Risk', 'High Risk'],
          datasets: [{
              data: [{{ stats.low_risk }}, {{ stats.medium_risk }}, {{ stats.high_risk }}],
              backgroundColor: [
                  'rgba(16, 185, 129, 0.8)',
                  'rgba(245, 158, 11, 0.8)',
                  'rgba(239, 68, 68, 0.8)'
              ],
              borderWidth: 2,
              borderColor: '#fff'
          }]
      },
      options: {
          responsive: true,
          plugins: {
              legend: {
                  position: 'bottom'
              }
          }
      }
  });

  // Line Chart - Score Trend
  const lineCtx = document.getElementById('lineChart').getContext('2d');
  const recentData = {{ recent|tojson|safe }};
  const labels = recentData.map(function(app) { return app.date; }).reverse();
  const scores = recentData.map(function(app) { return app.score; }).reverse();

  new Chart(lineCtx, {
      type: 'line',
      data: {
          labels: labels,
          datasets: [{
              label: 'Credit Score',
              data: scores,
              borderColor: 'rgb(79, 70, 229)',
              backgroundColor: 'rgba(79, 70, 229, 0.1)',
              tension: 0.4,
              fill: true
          }]
      },
      options: {
          responsive: true,
          scales: {
              y: {
                  beginAtZero: false,
                  min: 300,
                  max: 900
              }
          },
          plugins: {
              legend: {
                  display: false
              }
          }
      }
  });
</script>
{% endblock %}
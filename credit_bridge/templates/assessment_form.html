{% extends "base.html" %}

{% block title %}New Assessment - FinInclusion AI{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        background: white;
        border-radius: 15px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .section-header {
        color: #4f46e5;
        font-weight: 700;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 3px solid #4f46e5;
    }
    
    .form-control, .form-select {
        border-radius: 10px;
        border: 2px solid #e5e7eb;
        padding: 0.75rem;
    }
    
    .form-control:focus, .form-select:focus {
        border-color: #4f46e5;
        box-shadow: 0 0 0 0.2rem rgba(79, 70, 229, 0.25);
    }
    
    .form-label {
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }
    
    .info-text {
        font-size: 0.875rem;
        color: #6b7280;
        margin-top: 0.25rem;
    }
    
    .required {
        color: #ef4444;
    }
    
    .submit-section {
        background: linear-gradient(135deg, rgba(79, 70, 229, 0.1), rgba(124, 58, 237, 0.1));
        border-radius: 15px;
        padding: 2rem;
        text-align: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="text-center mb-4">
            <h1 class="display-5 fw-bold" style="color: white;">
                <i class="bi bi-clipboard-data"></i> New Credit Assessment
            </h1>
            <p style="color: rgba(255,255,255,0.9);">Fill in applicant details for AI-powered credit risk evaluation</p>
        </div>
        
        <form method="POST" action="{{ url_for('create_assessment') }}" id="assessmentForm">
            <!-- Personal Information -->
            <div class="form-section">
                <h3 class="section-header">
                    <i class="bi bi-person-badge"></i> Personal Information
                </h3>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="name" class="form-label">
                            Full Name <span class="required">*</span>
                        </label>
                        <input type="text" class="form-control" id="name" name="name" 
                               placeholder="Enter full name" required>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="phone" class="form-label">
                            Phone Number <span class="required">*</span>
                        </label>
                        <input type="tel" class="form-control" id="phone" name="phone" 
                               placeholder="+91 9876543210" required>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="email" class="form-label">Email Address</label>
                        <input type="email" class="form-control" id="email" name="email" 
                               placeholder="applicant@example.com">
                        <div class="info-text">Optional but recommended</div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="pan_card" class="form-label">PAN Card Number</label>
                        <input type="text" class="form-control" id="pan_card" name="pan_card" 
                               placeholder="ABCDE1234F" maxlength="10" pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}">
                        <div class="info-text">Format: ABCDE1234F</div>
                    </div>
                </div>
            </div>
            
            <!-- Financial Behavior Data -->
            <div class="form-section">
                <h3 class="section-header">
                    <i class="bi bi-cash-stack"></i> Financial Behavior Data
                </h3>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="monthly_income" class="form-label">
                            Monthly Income (₹) <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="monthly_income" name="monthly_income" 
                               placeholder="45000" min="5000" step="1000" required>
                        <div class="info-text">Average monthly income from all sources</div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="monthly_expenses" class="form-label">
                            Monthly Expenses (₹) <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="monthly_expenses" name="monthly_expenses" 
                               placeholder="30000" min="1000" step="1000" required>
                        <div class="info-text">Average monthly spending</div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="income_std_dev" class="form-label">
                            Income Variation (₹) <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="income_std_dev" name="income_std_dev" 
                               placeholder="5000" min="0" step="500" required>
                        <div class="info-text">Standard deviation in monthly income (lower is better)</div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="savings_amount" class="form-label">
                            Total Savings (₹) <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="savings_amount" name="savings_amount" 
                               placeholder="100000" min="0" step="5000" required>
                        <div class="info-text">Current total savings amount</div>
                    </div>
                </div>
            </div>
            
            <!-- Digital Activity -->
            <div class="form-section">
                <h3 class="section-header">
                    <i class="bi bi-phone"></i> Digital Activity & Payment Behavior
                </h3>
                
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="upi_transactions" class="form-label">
                            Monthly UPI Transactions <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="upi_transactions" name="upi_transactions" 
                               placeholder="25" min="0" required>
                        <div class="info-text">Number of UPI payments per month</div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <label for="bill_payment_streak" class="form-label">
                            Bill Payment Streak <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="bill_payment_streak" name="bill_payment_streak" 
                               placeholder="10" min="0" max="24" required>
                        <div class="info-text">Consecutive months of on-time payments (max 24)</div>
                    </div>
                    
                    <div class="col-md-4 mb-3">
                        <label for="digital_months" class="form-label">
                            Digital Banking Period <span class="required">*</span>
                        </label>
                        <input type="number" class="form-control" id="digital_months" name="digital_months" 
                               placeholder="12" min="0" max="60" required>
                        <div class="info-text">Months using digital banking</div>
                    </div>
                </div>
            </div>
            
            <!-- Business Data (Optional) -->
            <div class="form-section">
                <h3 class="section-header">
                    <i class="bi bi-briefcase"></i> Business Data (If Self-Employed)
                </h3>
                <p class="text-muted mb-3">Leave blank if not applicable or enter 0</p>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="business_revenue" class="form-label">
                            Monthly Business Revenue (₹)
                        </label>
                        <input type="number" class="form-control" id="business_revenue" name="business_revenue" 
                               placeholder="75000" min="0" step="5000" value="0">
                        <div class="info-text">Average monthly business income</div>
                    </div>
                    
                    <div class="col-md-6 mb-3">
                        <label for="business_expenses" class="form-label">
                            Monthly Business Expenses (₹)
                        </label>
                        <input type="number" class="form-control" id="business_expenses" name="business_expenses" 
                               placeholder="50000" min="0" step="5000" value="0">
                        <div class="info-text">Average monthly business costs</div>
                    </div>
                </div>
            </div>
            
            <!-- Disclaimer & Submit -->
            <div class="submit-section">
                <div class="alert alert-info mb-4" role="alert">
                    <i class="bi bi-info-circle"></i> <strong>Note:</strong> This assessment uses AI/ML algorithms 
                    to evaluate creditworthiness based on behavioral financial data. Results should be reviewed 
                    by authorized personnel before making final lending decisions.
                </div>
                
                <button type="submit" class="btn btn-primary btn-lg px-5">
                    <i class="bi bi-cpu"></i> Generate Credit Assessment
                </button>
                
                <div class="mt-3">
                    <a href="{{ url_for('home') }}" class="text-muted">
                        <i class="bi bi-arrow-left"></i> Cancel and return to home
                    </a>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
// Form validation
document.getElementById('assessmentForm').addEventListener('submit', function(e) {
    const income = parseFloat(document.getElementById('monthly_income').value);
    const expenses = parseFloat(document.getElementById('monthly_expenses').value);
    
    if (expenses > income) {
        alert('Warning: Monthly expenses exceed monthly income. This may affect credit score.');
    }
});

// Auto-format PAN card input
document.getElementById('pan_card').addEventListener('input', function(e) {
    this.value = this.value.toUpperCase();
});

// Auto-format phone number
document.getElementById('phone').addEventListener('input', function(e) {
    let value = this.value.replace(/\D/g, '');
    if (value.length > 10) {
        value = value.slice(0, 10);
    }
    if (value.length === 10 && !this.value.startsWith('+91')) {
        this.value = '+91 ' + value;
    }
});
</script>

{% endblock %}